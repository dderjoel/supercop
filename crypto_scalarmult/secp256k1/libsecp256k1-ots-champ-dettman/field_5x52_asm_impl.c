#include "field_5x52_asm_impl.h"

void secp256k1_fe_mul_inner(uint64_t *r, const uint64_t *a, const uint64_t *b) {
  uint64_t tmp0;
  uint64_t tmp1;
  uint64_t tmp2;
  uint64_t tmp3;
  uint64_t tmp4;
  asm volatile("mov    %%rdx,%%rax\n"
               "mov    (%%rdx),%%rdx\n"
               "mulx   0x18(%%rsi),%%r10,%%r11\n"
               "mov    0x8(%%rax),%%rdx\n"
               "mulx   0x20(%%rsi),%%rcx,%%r8\n"
               "mov    0x10(%%rsi),%%rdx\n"
               "mulx   0x8(%%rax),%%r9,%%rbx\n"
               "test   %%al,%%al\n"
               "adox   %%r9,%%r10\n"
               "adox   %%r11,%%rbx\n"
               "mov    0x18(%%rsi),%%rdx\n"
               "mulx   0x8(%%rax),%%r11,%%r9\n"
               "mov    0x18(%%rax),%%rdx\n"
               "mulx   0x10(%%rsi),%%rbp,%%r12\n"
               "mov    0x18(%%rax),%%rdx\n"
               "mulx   (%%rsi),%%r13,%%r14\n"
               "mov    0x10(%%rax),%%rdx\n"
               "mov    %%rdi,%q0\n"
               "mulx   0x8(%%rsi),%%r15,%%rdi\n"
               "adcx   %%r15,%%r10\n"
               "adcx   %%rbx,%%rdi\n"
               "mov    0x20(%%rax),%%rdx\n"
               "mulx   0x20(%%rsi),%%rbx,%%r15\n"
               "movabs $0x1000003d10,%%rdx\n"
               "mov    %%r12,%q1\n"
               "mov    %%rbp,%q2\n"
               "mulx   %%rbx,%%r12,%%rbp\n"
               "xor    %%rbx,%%rbx\n"
               "adox   %%r13,%%r10\n"
               "adox   %%rdi,%%r14\n"
               "adcx   %%r10,%%r12\n"
               "adcx   %%rbp,%%r14\n"
               "mov    %%r12,%%r13\n"
               "shrd   $0x34,%%r14,%%r13\n"
               "mov    0x20(%%rsi),%%rdx\n"
               "mulx   (%%rax),%%rdi,%%rbp\n"
               "test   %%al,%%al\n"
               "adox   %%r11,%%rdi\n"
               "adox   %%rbp,%%r9\n"
               "mov    0x10(%%rax),%%rdx\n"
               "mulx   0x10(%%rsi),%%r11,%%r10\n"
               "mov    0x18(%%rax),%%rdx\n"
               "mulx   0x8(%%rsi),%%r14,%%rbp\n"
               "adcx   %%r11,%%rdi\n"
               "adcx   %%r9,%%r10\n"
               "add    %%r14,%%rdi\n"
               "adcx   %%r10,%%rbp\n"
               "mov    (%%rsi),%%rdx\n"
               "mulx   0x20(%%rax),%%r9,%%r11\n"
               "xor    %%rdx,%%rdx\n"
               "adox   %%r9,%%rdi\n"
               "adox   %%rbp,%%r11\n"
               "adcx   %%r13,%%rdi\n"
               "adc    $0x0,%%r11\n"
               "mov    0x18(%%rsi),%%rdx\n"
               "mulx   0x10(%%rax),%%rbx,%%r13\n"
               "movabs $0x1000003d10000,%%rdx\n"
               "mulx   %%r15,%%r14,%%r10\n"
               "test   %%al,%%al\n"
               "adox   %%rdi,%%r14\n"
               "adox   %%r10,%%r11\n"
               "mov    0x8(%%rsi),%%rdx\n"
               "mulx   0x20(%%rax),%%rbp,%%r9\n"
               "adcx   %%rbx,%%rcx\n"
               "adcx   %%r8,%%r13\n"
               "xor    %%rdx,%%rdx\n"
               "adox   %q2,%%rcx\n"
               "adox   %q1,%%r13\n"
               "movabs $0xfffffffffffff,%%r8\n"
               "mov    %%r14,%%rdi\n"
               "and    %%r8,%%rdi\n"
               "movabs $0xffffffffffff,%%r15\n"
               "mov    %%rdi,%%rbx\n"
               "and    %%r15,%%rbx\n"
               "shrd   $0x34,%%r11,%%r14\n"
               "xor    %%r10,%%r10\n"
               "adox   %%rbp,%%rcx\n"
               "adox   %%r13,%%r9\n"
               "mov    (%%rax),%%rdx\n"
               "mulx   (%%rsi),%%r11,%%rbp\n"
               "adcx   %%r14,%%rcx\n"
               "adc    $0x0,%%r9\n"
               "mov    %%rcx,%%rdx\n"
               "and    %%r8,%%rdx\n"
               "shl    $0x4,%%rdx\n"
               "shr    $0x30,%%rdi\n"
               "lea    (%%rdi,%%rdx,1),%%rdi\n"
               "mov    0x20(%%rsi),%%rdx\n"
               "mulx   0x10(%%rax),%%r13,%%r14\n"
               "mov    0x18(%%rsi),%%rdx\n"
               "mulx   0x18(%%rax),%%r10,%%r15\n"
               "movabs $0x1000003d1,%%rdx\n"
               "mov    %%rbx,%q3\n"
               "mulx   %%rdi,%%r8,%%rbx\n"
               "test   %%al,%%al\n"
               "adox   %%r11,%%r8\n"
               "adox   %%rbx,%%rbp\n"
               "mov    0x20(%%rax),%%rdx\n"
               "mulx   0x18(%%rsi),%%r11,%%rdi\n"
               "mov    0x20(%%rax),%%rdx\n"
               "mov    %%rdi,%q4\n"
               "mulx   0x10(%%rsi),%%rbx,%%rdi\n"
               "adcx   %%r10,%%r13\n"
               "adcx   %%r14,%%r15\n"
               "mov    0x8(%%rax),%%rdx\n"
               "mulx   (%%rsi),%%r14,%%r10\n"
               "test   %%al,%%al\n"
               "adox   %%rbx,%%r13\n"
               "adox   %%r15,%%rdi\n"
               "shrd   $0x34,%%r9,%%rcx\n"
               "xor    %%rdx,%%rdx\n"
               "adox   %%rcx,%%r13\n"
               "adox   %%rdx,%%rdi\n"
               "mov    %%r8,%%r9\n"
               "shrd   $0x34,%%rbp,%%r9\n"
               "movabs $0xfffffffffffff,%%rbp\n"
               "mov    %%r13,%%rbx\n"
               "and    %%rbp,%%rbx\n"
               "shrd   $0x34,%%rdi,%%r13\n"
               "mov    0x20(%%rsi),%%rdx\n"
               "mulx   0x18(%%rax),%%r15,%%rcx\n"
               "add    %%r11,%%r15\n"
               "adcx   %q4,%%rcx\n"
               "xor    %%rdx,%%rdx\n"
               "adox   %%r13,%%r15\n"
               "adox   %%rdx,%%rcx\n"
               "mov    0x8(%%rsi),%%rdx\n"
               "mulx   (%%rax),%%r11,%%rdi\n"
               "adcx   %%r14,%%r11\n"
               "adcx   %%rdi,%%r10\n"
               "movabs $0x1000003d10,%%rdx\n"
               "mulx   %%rbx,%%r14,%%r13\n"
               "xor    %%rbx,%%rbx\n"
               "adox   %%r9,%%r11\n"
               "adox   %%rbx,%%r10\n"
               "adcx   %%r11,%%r14\n"
               "adcx   %%r13,%%r10\n"
               "mov    0x8(%%rsi),%%rdx\n"
               "mulx   0x8(%%rax),%%r9,%%rdi\n"
               "mov    (%%rax),%%rdx\n"
               "mulx   0x10(%%rsi),%%r13,%%r11\n"
               "test   %%al,%%al\n"
               "adox   %%r9,%%r13\n"
               "adox   %%r11,%%rdi\n"
               "mov    (%%rsi),%%rdx\n"
               "mulx   0x10(%%rax),%%r9,%%r11\n"
               "adcx   %%r9,%%r13\n"
               "adcx   %%rdi,%%r11\n"
               "movabs $0x1000003d10,%%rdx\n"
               "mulx   %%r15,%%rdi,%%r9\n"
               "mov    %%r14,%%r15\n"
               "shrd   $0x34,%%r10,%%r15\n"
               "xor    %%r10,%%r10\n"
               "adox   %%r15,%%r13\n"
               "adox   %%r10,%%r11\n"
               "adcx   %%r13,%%rdi\n"
               "adcx   %%r9,%%r11\n"
               "and    %%rbp,%%r12\n"
               "mov    %%rdi,%%rbx\n"
               "shrd   $0x34,%%r11,%%rbx\n"
               "lea    (%%rbx,%%r12,1),%%rbx\n"
               "and    %%rbp,%%rdi\n"
               "mov    %q0,%%r9\n"
               "mov    %%rdi,0x10(%%r9)\n"
               "movabs $0x1000003d10000,%%r15\n"
               "mov    %%rcx,%%rdx\n"
               "mulx   %%r15,%%rcx,%%r13\n"
               "adox   %%rbx,%%rcx\n"
               "adox   %%r10,%%r13\n"
               "mov    %%rcx,%%r11\n"
               "and    %%rbp,%%r11\n"
               "shrd   $0x34,%%r13,%%rcx\n"
               "and    %%rbp,%%r14\n"
               "mov    %%r14,0x8(%%r9)\n"
               "and    %%rbp,%%r8\n"
               "mov    %%r8,(%%r9)\n"
               "mov    %%r11,0x18(%%r9)\n"
               "add    %q3,%%rcx\n"
               "mov    %%rcx,0x20(%%r9)\n"

               : "=&m"(tmp0), "=&m"(tmp1), "=&m"(tmp2), "=&m"(tmp3),
                 "=&m"(tmp4), "+D"(r), "+d"(b)
               : "S"(a)
               : "rax", "rbx", "rcx", "r8", "r9", "r10", "r11", "r12", "r13",
                 "rbp", "r14", "r15", "cc", "memory");
}

void secp256k1_fe_sqr_inner(uint64_t *r, const uint64_t *a) {

  asm volatile("mov    0x20(%%rsi),%%rdx\n"
               "mulx   %%rdx,%%rax,%%r10\n"
               "mov    (%%rsi),%%r11\n"
               "mov    %%r11,%%rdx\n"
               "shl    %%rdx\n"
               "mov    0x10(%%rsi),%%r11\n"
               "lea    (%%r11,%%r11,1),%%rcx\n"
               "mulx   0x18(%%rsi),%%r11,%%r8\n"
               "mov    0x8(%%rsi),%%r9\n"
               "lea    (%%r9,%%r9,1),%%rbx\n"
               "mov    %%rdx,%%r9\n"
               "mov    0x10(%%rsi),%%rdx\n"
               "mulx   %%rbx,%%rbp,%%r12\n"
               "test   %%al,%%al\n"
               "adox   %%r11,%%rbp\n"
               "adox   %%r12,%%r8\n"
               "movabs $0x1000003d10,%%rdx\n"
               "mulx   %%rax,%%r11,%%r12\n"
               "adcx   %%rbp,%%r11\n"
               "adcx   %%r12,%%r8\n"
               "mov    %%r11,%%rax\n"
               "shrd   $0x34,%%r8,%%rax\n"
               "mov    0x18(%%rsi),%%rdx\n"
               "mulx   %%rbx,%%rbp,%%r12\n"
               "mov    0x10(%%rsi),%%rdx\n"
               "mulx   %%rdx,%%r8,%%r13\n"
               "xor    %%rdx,%%rdx\n"
               "adox   %%rbp,%%r8\n"
               "adox   %%r13,%%r12\n"
               "mov    %%r9,%%rdx\n"
               "mulx   0x20(%%rsi),%%r9,%%rbp\n"
               "adcx   %%r9,%%r8\n"
               "adcx   %%r12,%%rbp\n"
               "mov    %%rdx,%%r13\n"
               "mov    0x20(%%rsi),%%rdx\n"
               "mulx   %%rbx,%%r12,%%r9\n"
               "add    %%rax,%%r8\n"
               "adc    $0x0,%%rbp\n"
               "movabs $0x1000003d10000,%%rdx\n"
               "mulx   %%r10,%%rbx,%%rax\n"
               "add    %%r8,%%rbx\n"
               "adcx   %%rax,%%rbp\n"
               "mov    %%rbx,%%r10\n"
               "shrd   $0x34,%%rbp,%%r10\n"
               "mov    %%rcx,%%rdx\n"
               "mulx   0x18(%%rsi),%%rcx,%%r8\n"
               "add    %%r12,%%rcx\n"
               "adcx   %%r8,%%r9\n"
               "add    %%r10,%%rcx\n"
               "adc    $0x0,%%r9\n"
               "movabs $0xfffffffffffff,%%r12\n"
               "and    %%r12,%%rbx\n"
               "mov    %%rdx,%%rax\n"
               "mov    0x18(%%rsi),%%rdx\n"
               "mulx   %%rdx,%%rbp,%%r10\n"
               "mov    %%rcx,%%rdx\n"
               "shrd   $0x34,%%r9,%%rdx\n"
               "mov    %%rbx,%%r8\n"
               "shr    $0x30,%%r8\n"
               "and    %%r12,%%rcx\n"
               "shl    $0x4,%%rcx\n"
               "lea    (%%r8,%%rcx,1),%%r8\n"
               "mov    %%rdx,%%r9\n"
               "mov    0x20(%%rsi),%%rdx\n"
               "mulx   %%rax,%%rcx,%%r14\n"
               "xor    %%rdx,%%rdx\n"
               "adox   %%rcx,%%rbp\n"
               "adox   %%r10,%%r14\n"
               "mov    (%%rsi),%%rdx\n"
               "mulx   %%rdx,%%rax,%%r10\n"
               "adcx   %%r9,%%rbp\n"
               "adc    $0x0,%%r14\n"
               "movabs $0x1000003d1,%%rdx\n"
               "mulx   %%r8,%%r9,%%rcx\n"
               "xor    %%r8,%%r8\n"
               "adox   %%rax,%%r9\n"
               "adox   %%rcx,%%r10\n"
               "mov    %%r9,%%rax\n"
               "and    %%r12,%%rax\n"
               "mov    %%r13,%%rdx\n"
               "mulx   0x8(%%rsi),%%r13,%%rcx\n"
               "mov    %%rax,(%%rdi)\n"
               "mulx   0x10(%%rsi),%%rax,%%r8\n"
               "shrd   $0x34,%%r10,%%r9\n"
               "xor    %%rdx,%%rdx\n"
               "adox   %%r9,%%r13\n"
               "adox   %%rdx,%%rcx\n"
               "mov    %%rbp,%%r10\n"
               "and    %%r12,%%r10\n"
               "movabs $0x1000003d10,%%r9\n"
               "mov    %%r9,%%rdx\n"
               "mulx   %%r10,%%r9,%%r15\n"
               "adox   %%r13,%%r9\n"
               "adox   %%r15,%%rcx\n"
               "mov    %%r9,%%r13\n"
               "and    %%r12,%%r13\n"
               "shrd   $0x34,%%rcx,%%r9\n"
               "imul   $0x2,0x18(%%rsi),%%r10\n"
               "mov    %%r13,0x8(%%rdi)\n"
               "mov    0x8(%%rsi),%%rdx\n"
               "mulx   %%rdx,%%r15,%%rcx\n"
               "mov    %%r10,%%rdx\n"
               "mulx   0x20(%%rsi),%%r10,%%r13\n"
               "shrd   $0x34,%%r14,%%rbp\n"
               "xor    %%r14,%%r14\n"
               "adox   %%rbp,%%r10\n"
               "adox   %%r14,%%r13\n"
               "adcx   %%rax,%%r15\n"
               "adcx   %%rcx,%%r8\n"
               "movabs $0x1000003d10,%%rax\n"
               "mov    %%rax,%%rdx\n"
               "mulx   %%r10,%%rax,%%rcx\n"
               "and    %%r12,%%r11\n"
               "movabs $0x1000003d10000,%%rbp\n"
               "mov    %%r13,%%rdx\n"
               "mulx   %%rbp,%%r13,%%r10\n"
               "adox   %%r9,%%r15\n"
               "adox   %%r14,%%r8\n"
               "adcx   %%r15,%%rax\n"
               "adcx   %%rcx,%%r8\n"
               "mov    %%rax,%%r9\n"
               "shrd   $0x34,%%r8,%%r9\n"
               "lea    (%%r9,%%r11,1),%%r9\n"
               "and    %%r12,%%rax\n"
               "adox   %%r9,%%r13\n"
               "adox   %%r14,%%r10\n"
               "mov    %%r13,%%rdx\n"
               "shrd   $0x34,%%r10,%%rdx\n"
               "mov    %%rax,0x10(%%rdi)\n"
               "and    %%r12,%%r13\n"
               "movabs $0xffffffffffff,%%rcx\n"
               "and    %%rcx,%%rbx\n"
               "lea    (%%rdx,%%rbx,1),%%rdx\n"
               "mov    %%rdx,0x20(%%rdi)\n"
               "mov    %%r13,0x18(%%rdi)\n"
               : "+D"(r)
               : "D"(r), "S"(a)
               : "rax", "rbx", "rcx", "rdx", "r8", "r9", "r10", "r11", "r12",
                 "rbp", "r13", "r14", "r15", "cc", "memory");
}
